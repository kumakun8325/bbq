# 🎯 BBQ (Bird Battle Quest) 仕様書

> **Version**: 0.1.0  
> **Last Updated**: 2025-12-13  
> **Status**: MVP開発中

---

## 📋 目次

1. [概要](#1-概要)
2. [機能仕様](#2-機能仕様)
3. [データ構造](#3-データ構造)
4. [UI/UXデザイン](#4-uiuxデザイン)
5. [技術スタック](#5-技術スタック)
6. [ファイル構成](#6-ファイル構成)

---

## 1. 概要

### 1.1 アプリケーション名
**BBQ (Bird Battle Quest)**

### 1.2 概要説明
FF6 × オクトパストラベラー風の2D RPG。
タイルマップ移動、ランダムエンカウント、シールド/ブレイクシステムを特徴とする。

### 1.3 主要機能
- FF6風タイルマップ移動
- ランダムエンカウントシステム
- オクトパストラベラー風バトル（シールド/ブレイク）
- 育成要素（レベルアップ、武器合成）

---

## 2. 機能仕様

### 2.1 機能一覧

| ID | 機能名 | 説明 | 状態 |
|----|--------|------|------|
| F-001 | マップ移動 | WASDで4方向移動 | ✅ |
| F-002 | エンカウント | ランダム敵遭遇 | ✅ |
| F-003 | バトル | ターン制コマンドバトル | ✅ |
| F-004 | シールド/ブレイク | 弱点とブレイクシステム | 🔮 |
| F-005 | セーブ/ロード | LocalStorage保存 | 🔮 |

### 2.2 機能詳細

#### F-001: マップ移動

**概要**: プレイヤーキャラクターをフィールドマップで操作

**操作フロー**:
1. WASDまたは矢印キーで移動方向を入力
2. プレイヤーが指定方向に移動
3. カメラがプレイヤーに追従

**入力**: WASD / 矢印キー
**出力**: プレイヤーの位置更新、カメラ追従

#### F-002: ランダムエンカウント

**概要**: マップ移動中にランダムで敵と遭遇

**操作フロー**:
1. プレイヤーが1タイル移動するごとに判定
2. エンカウント率（10%）で判定
3. エンカウント時はフラッシュ演出
4. バトルシーンに遷移

**判定式**: `Math.random() < 0.10`

#### F-003: ターン制バトル

**概要**: コマンド選択式のターン制バトル

**コマンド**:
- **たたかう**: 通常攻撃
- **ぼうぎょ**: 被ダメージ1/2
- **にげる**: 50%で逃走成功

**勝利条件**: 敵HPが0
**敗北条件**: プレイヤーHPが0

---

## 3. データ構造

### 3.1 主要データ型

```typescript
// キャラクターステータス
interface CharacterStats {
  hp: number;
  maxHp: number;
  attack: number;
  defense: number;
  speed: number;
  level: number;
  exp: number;
}

// 敵データ
interface EnemyData {
  id: string;
  name: string;
  hp: number;
  maxHp: number;
  attack: number;
  defense: number;
  color: number;        // プレースホルダー色
  width: number;
  height: number;
}

// シールド/ブレイク対応 (v0.2)
interface BreakableEnemy extends EnemyData {
  shield: number;
  maxShield: number;
  weaknesses: ElementType[];
  isBroken: boolean;
}
```

### 3.2 永続化

| キー | 用途 |
|------|------|
| `bbq_savedata` | セーブデータ |
| `bbq_settings` | 設定 |

---

## 4. UI/UXデザイン

### 4.1 画面構成

```
┌────────────────────────────────────────┐
│           ゲーム画面 (480x320)          │
├────────────────────────────────────────┤
│                                        │
│          メインコンテンツ               │
│       (マップ / バトル / メニュー)       │
│                                        │
├────────────────────────────────────────┤
│     コマンド / メッセージウィンドウ       │
└────────────────────────────────────────┘
```

### 4.2 レスポンシブ対応

| デバイス | 画面幅 | レイアウト |
|----------|--------|------------|
| スマートフォン | < 768px | タッチ操作対応 |
| タブレット | 768px - 1024px | 最適表示 |
| PC | > 1024px | キーボード操作 |

### 4.3 アートスタイル

キャラクターデザイン（頭身）等のビジュアル表現は、以下の「オクトパストラベラー」風のドット絵スタイルを参考にする。

- **参考URL**: [https://dotartplay.com/octopathtraveler-dot](https://dotartplay.com/octopathtraveler-dot)
- **特徴**:
  - 頭身を少し高めに設定（2.5〜3頭身）
  - 陰影を強調したリッチなドット絵
  - 地面に影を落とす


### 4.3 ATBゲージ位置調整（開発者向け注意事項）

ATBゲージの位置がずれる問題が頻発するため、修正方法を記載します。

**問題**: ATBゲージがMP表示と高さが揃わない、または枠からはみ出る

**原因**: ATBゲージは以下の**3箇所**で描画位置が設定されており、すべてを同じ値にする必要があります。

| 箇所 | ファイル | 行（目安） | 用途 |
|------|----------|------------|------|
| 1. createUI | BattleScene.ts | ~634行 | 初期描画 |
| 2. updateAtbBarForMember | BattleScene.ts | ~908行 | 行動後の更新 |
| 3. update | BattleScene.ts | ~2296行 | 毎フレーム更新 |

**修正方法**:
1. 3箇所すべてで `rowY + N` の `N` を同じ値にする
2. 枠は `rowY + 2` で描画されているため、バーは `rowY + 4` で枠内に収まる
3. `N` を変更する場合は、必ず3箇所すべてを同時に変更すること

**現在の正しい値**:
```typescript
// 枠: rowY + 2 (高さ10、境界線2px)
// バー: rowY + 4 (枠の内側に描画)
```

---

## 5. 技術スタック

### 5.1 フロントエンド

| カテゴリ | 技術 |
|----------|------|
| 言語 | TypeScript |
| ゲームエンジン | Phaser 3 |
| ビルド | Webpack 5 |
| マップエディタ | Tiled |

### 5.2 ホスティング

| カテゴリ | 技術 |
|----------|------|
| 本番環境 | Firebase Hosting |
| PWA | 対応予定 |
| URL | TBD |

---

## 6. ファイル構成

```
bbq/
├── src/
│   ├── main.ts
│   ├── config/
│   │   └── gameConfig.ts
│   ├── scenes/
│   │   ├── BootScene.ts
│   │   ├── PreloadScene.ts
│   │   ├── TitleScene.ts
│   │   ├── MapScene.ts
│   │   └── BattleScene.ts
│   └── types/
│       └── index.ts
├── public/
│   └── favicon.ico
├── docs/
│   ├── SPECIFICATION.md
│   └── DEVELOPMENT_WORKFLOW.md
├── .kiro/steering/
│   ├── requirements.md
│   ├── design.md
│   └── tasks.md
├── CHANGELOG.md
└── README.md
```

---

*この仕様書はプロジェクトの中心的なドキュメントです。*
